app-id: com.vagueentertainment.Framed
runtime: org.freedesktop.Platform
runtime-version: '20.08'
sdk: org.freedesktop.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.rust-nightly
command: framed
modules: 
  
  - name: framed
    buildsystem: simple
    build-commands:
      - install -D -m755 Framed.x86_64 /app/bin/Framed.x86_64
      - install -D Framed.pck /app/bin/Framed.pck
      - cp -r HoneyComb-redistributable /app/bin/HoneyComb-redistributable
      #- install -D icon.png /app/bin/icon.png
      - install -D -m755 framed.sh /app/bin/framed
      - desktop-file-edit --remove-key=PrefersNonDefaultGPU $FLATPAK_ID.desktop
      - desktop-file-edit --set-icon=$FLATPAK_ID $FLATPAK_ID.desktop
      - install -Dm644 $FLATPAK_ID.desktop /app/share/applications/$FLATPAK_ID.desktop
      - install -Dm644 icon.svg /app/share/icons/hicolor/scalable/apps/$FLATPAK_ID.svg
      - >
        for size in {32,64,128,256}; do
          svg-convert icon.png -w "$size" -h "$size" -a -f png -o "$size.png";
          install -Dm644 "$size.png" "/app/share/icons/hicolor/${size}x${size}/apps/$FLATPAK_ID.png";
       done
      
    sources:
      - type: dir
        path: HoneyComb-redistributable
        dest: HoneyComb-redistributable
        
      - type: file
        path: Framed.x86_64
        
      - type: file
        path: Framed.pck
        
      - type: script
        dest-filename: framed.sh
        commands:
          - export APPDATA="$XDG_DATA_HOME"
          - export XDG_DATA_HOME="$APPDATA"
          - export HOME="$APPDATA"
          - export PATH=$PATH:/app/bin/HoneyComb-redistributable/service
          #- sh
          - /app/bin/Framed.x86_64 --path=/app/bin/
          
      - type: file
        path: icon.svg
        
      - type: file
        path: com.vagueentertainment.Framed.appdata.xml
        
      - type: file
        path: com.vagueentertainment.Framed.desktop
        
  - modules/python3-pip.json      
  - modules/python3-wheel.json
  - modules/python3-semantic_version.json
  - modules/python3-setuptools.json
  - modules/python3-setuptools_rust.json
  - modules/python3-setuptools_scm.json
  - modules/python3-bottle.json
  - modules/python3-requests.json
  - modules/python3-netifaces.json
  - modules/python3-cryptography.json
  - modules/python3-pycrypto.json
  - modules/python3-pyopenssl.json
  - modules/python3-wcwidth.json
  - modules/python3-prettytable.json
  - modules/python3-steem.json
  - modules/python3-hivepy.json
  - modules/python3-websockets.json
  - modules/python3-asyncio.json
        
finish-args:
  - --share=ipc
  - --socket=x11
  - --share=network
  - --socket=pulseaudio
  - --filesystem=home:ro
  - --device=all
  - --talk-name=org.freedesktop.Flatpak
